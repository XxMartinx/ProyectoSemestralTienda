{% extends 'tienda/base.html' %}

{% load static %}

{% load humanize %}

{% block contenido %}
    <div class="titulo-albion">
        <h1>Carrito De Compras</h1>
        <h3>Carrito De {{ usuario.username|capfirst }}</h3>
    </div>
    <div class="container albion">
        {% for item in items_carrito %}
            <div class="albion-item">
                <div class="albion-imagen">
                    {% if item.producto.imagen %}
                        <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.titulo }}">
                    {% else %}
                        <div class="no-image-placeholder"></div>
                    {% endif %}
                </div>
                <div class="detalle-producto">
                    <h1>{{ item.producto.titulo | title }}</h1>
                    <h2>Esto Falta</h2>
                    <p>${{ item.producto.precio| intcomma }}</p>
                </div>
                <div class="albion-borrar">
                    <a href="{% url 'item_carrito_delete' item.id %}">
                        <i class="far fa-trash-alt" style="color: #050000;"></i>
                    </a>
                </div>
            </div>
        {% empty %}
            <div class="col-12 p-0 m-0">
                <p class="d-flex justify-content-between align-items-center">
                    No tienes ningún producto en el carrito
                </p>
            </div>
        {% endfor %}
        <div class="albion-totales">
            {% if items_carrito %}
                <p>Subtotal: ${{ total_carrito| intcomma }}</p>
                <p>Cargo servicio: ${{ monto_extra| intcomma }}</p>
                <p><b>Total: ${{ total_carrito_impuesto| intcomma }}</b></p>
            {% endif %}
        </div>
        <div class="albion-botones">
            <button class="btn btn-danger btn-block"><a href="{% url 'carrito_clean' %}">Vaciar Carrito</a></button>    
            <button class="btn btn-primary btn-block"><a href="{% url 'home' %}">Seguir Comprando</a></button>
            {% if items_carrito %}
                <button class="btn btn-success btn-block float-end" onclick="confirmarCompra()">Finalizar Compra</button>
            {% else %}
                <button class="btn btn-success btn-block float-end" disabled>Finalizar Compra</button>
            {% endif %}
        </div>
    </div>

    <script>
        function confirmarCompra() {
            if (confirm("¿Estás seguro de que deseas finalizar la compra?")) {
                window.location.href = "{% url 'finalizar_compra' %}";
            }
        }
    </script>
{% endblock %}


